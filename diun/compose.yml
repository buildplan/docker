name: diun
services:
  diun:
    image: ghcr.io/crazy-max/diun:latest
    container_name: diun
    command: serve
    hostname: HexServer # server name
    read_only: true
    volumes:
      - ./data:/data
      - /var/run/docker.sock:/var/run/docker.sock:ro
    tmpfs:
      - /tmp:size=64M,mode=1777
    environment:
      TZ: Europe/London
      DIUN_WATCH_WORKERS: 20
      DIUN_WATCH_SCHEDULE: 0 8,20 * * *
      DIUN_WATCH_JITTER: 30s
      DIUN_PROVIDERS_DOCKER: "true"
      DIUN_PROVIDERS_DOCKER_WATCHBYDEFAULT: "true"
      DIUN_PROVIDERS_DOCKER_WATCHSTOPPED: "true"
      DIUN_WATCH_HEALTHCHECKS_UUID: ${HEALTHCHECKS_UUID} # healthchecks.io in .env
      DIUN_NOTIF_NTFY_ENDPOINT: ${NTFY_ENDPOINT} # ntfy settings in .env
      DIUN_NOTIF_NTFY_TOPIC: ${NTFY_TOPIC}
      DIUN_NOTIF_NTFY_TOKEN: ${NTFY_TOKEN}
      DIUN_NOTIF_NTFY_PRIORITY: 3
      DIUN_NOTIF_NTFY_TAGS: whale,package
      DIUN_NOTIF_NTFY_TIMEOUT: 10s
      DIUN_NOTIF_NTFY_TEMPLATETITLE: üê≥ [{{ .Meta.Hostname }}] {{ .Entry.Image }} update
      DIUN_NOTIF_NTFY_TEMPLATEBODY: |
        üì¶ **{{ .Entry.Image }}** has an update available
        Registry: {{ .Entry.Image.Domain }}
        Host: {{ .Meta.Hostname }}
        Status: {{ .Entry.Status }}
    labels:
      - diun.enable=true
    restart: unless-stopped
    logging:
      driver: json-file
      options:
        max-size: 5m
        max-file: "2"
    security_opt:
      - no-new-privileges:true
networks: {}
